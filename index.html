<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script>

        var rates = [
            {
                text: '20积分1',
                rate: '0.125'
            },
            {
                text: '一张卡券2',
                rate: '0.125'
            },
            {
                text: '未中奖3',
                rate: '0.125'
            },
            {
                text: '未中奖4',
                rate: '0.125'
            },
            {
                text: '未中奖5',
                rate: '0.125'
            },
            {
                text: '未中奖6',
                rate: '0.125'
            },
            {
                text: '未中奖7',
                rate: '0.125'
            },
            {
                text: '未中奖8',
                rate: '0.125'
            }
        ];
        var rateI = 5;


        function rotate (config) {
            var c = document.getElementById("canvas");
            c.setAttribute('width', config.canvasWidth);
            c.setAttribute('height', config.canvasHeight);

            var runTime = config.runTime || 10000;
            var timeStart = new Date().getTime();

            var lastRotateAngle = (function getLastRotateAngle (rates, rateI) {
                                        var awardAngle = 0;
                                        for (var i = 0; i < rateI; i++) {
                                            if (i === rateI - 1) {
                                                awardAngle = awardAngle + 2 * Math.PI * (rates[i].rate / 2);
                                            } else {
                                                awardAngle = awardAngle + 2 * Math.PI * rates[i].rate;
                                            }
                                        }

                                        return Math.PI * (2 - 1 / 2) - awardAngle;
                                    })();

            var rates = config.rates || alert('rates 参数不能为空');
            var rateI = config.rateI || alert('rateI 不能为空');
            var canvasWidth = config.canvasWidth;
            var canvasHeight = config.canvasHeight;

            draw();

            function draw() {
                var ctx = c.getContext('2d');

                ctx.save();

                ctx.translate(canvasWidth / 2, canvasHeight / 2);

                var lastTime = runTime - (new Date().getTime() - timeStart);

                if (lastTime > 0) {
                    ctx.clearRect(0, 0, canvasWidth, canvasHeight);
                    var rotateAngle = lastRotateAngle + 2 * Math.PI - Math.pow(lastTime / 1000, 2) % (2 * Math.PI);
                } else {
                    window.cancelAnimationFrame(draw);
                    return;
                }

                ctx.rotate(rotateAngle);

                var radius = 150;

                var startAngle = 0;
                var endAngle = 0;

                var color1 = '#2EC4B6';
                var color2 = '#E71D36';

                for (var i in rates) {
                    ctx.save();
                    ctx.beginPath();

                    endAngle = startAngle + rates[i].rate * 2 * Math.PI;

                    if (i%2 === 0) {
                        ctx.fillStyle = '#2EC4B6';
                    } else {
                        ctx.fillStyle = '#E71D36';
                    }

                    ctx.moveTo(0, 0);
                    ctx.lineTo(radius * Math.cos(startAngle), radius * Math.sin(startAngle));
                    ctx.arc(0, 0, radius, startAngle, endAngle);
                    ctx.fill();

                    var textAngle = startAngle + (endAngle - startAngle) / 2;
                    var textX = (0.8 * radius) * Math.cos(textAngle);
                    var textY = (0.8 * radius) * Math.sin(textAngle);

                    ctx.translate(textX, textY);
                    ctx.rotate(Math.PI / 2 + textAngle);
                    ctx.fillStyle = '#FFFFFF';
                    ctx.textAlign = 'center';
                    ctx.fillText(rates[i].text, 0, 0);

                    startAngle = endAngle;

                    ctx.closePath();

                    ctx.restore();
                }
                ctx.restore();

                window.requestAnimationFrame(draw);
            }
        }

        rotate({
            id: 'canvas',
            canvasWidth: 400,
            canvasHeight: 400,
            rates: rates,
            rateI: rateI
        });
    </script>
</body>
</html>